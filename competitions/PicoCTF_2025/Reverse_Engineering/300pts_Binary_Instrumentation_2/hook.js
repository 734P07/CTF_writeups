/*
 * Auto-generated by Frida. Please modify to match the signature of WriteFile.
 * This stub is currently auto-generated from manpages when available.
 *
 * For full API reference, see: https://frida.re/docs/javascript-api/
 */

console.log("-----------------------------------------------------------");
console.log("CREATE FILE");
console.log("-----------------------------------------------------------");

var createFile = Module.getExportByName("kernel32.dll", "CreateFileA");

Interceptor.attach(createFile, {
  onEnter: function(args){
    console.log("File path: " + args[0].readUtf8String());
    const buf = Memory.allocUtf8String('./flag');
    this.buf = buf;
    args[0] = buf;
    console.log("\nFile path replaced: " + args[0].readUtf8String());
  },
  onLeave: function(result){
    console.log("Result: " + result);
  }
});

console.log("-----------------------------------------------------------");
console.log("WRITE FILE");
console.log("-----------------------------------------------------------");

var writeFile = Module.getExportByName("kernel32.dll", "WriteFile");

Interceptor.attach(writeFile, {
  onEnter: function(args){
    console.log("Content: " + args[1].readUtf8String());
  },
  onLeave: function(result){
    console.log("Result: " + result);
  }
});